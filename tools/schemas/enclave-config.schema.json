{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SGX-LKL enclave config schema",
  "required": [
    "mode",
    "run",
    "disks"
  ],
  "additionalProperties": false,
  "definitions": {
    "safe_number": {
      "type": "string",
      "pattern": "^0$|^[1-9][0-9]*$"
    },
    "sgxlkl_enclave_mode_t": {
      "enum": [
        "UNKNOWN_MODE",
        "SW_DEBUG_MODE",
        "HW_DEBUG_MODE",
        "HW_RELEASE_MODE"
      ]
    },
    "sgxlkl_enclave_mmap_files_t": {
      "enum": [
        "ENCLAVE_MMAP_FILES_NONE",
        "ENCLAVE_MMAP_FILES_PRIVATE",
        "ENCLAVE_MMAP_FILES_SHARED"
      ]
    },
    "sgxlkl_exit_status_mode_t": {
      "enum": [
        "EXIT_STATUS_FULL",
        "EXIT_STATUS_BINARY",
        "EXIT_STATUS_NONE"
      ]
    },
    "Elf64_auxv_t": {
      "type": "object",
      "properties": {
        "a_type": {
          "type": "string"
        },
        "a_val": {
          "type": "string"
        }
      }
    },
    "sgxlkl_clock_res_config_t": {
      "type": "object",
      "properties": {
        "resolution": {
          "type": "string",
          "minLength": 16,
          "maxLength": 16,
          "pattern": "^[0-9A-Fa-f]+$"
        }
      }
    },
    "sgxlkl_enclave_disk_config_t": {
      "type": "object",
      "description": "Disk configuration",
      "required": [
        "mnt"
      ],
      "additionalProperties": false,
      "dependencies": {
        "roothash": [
          "roothash_offset"
        ],
        "roothash_offset": [
          "roothash"
        ],
        "create": [
          "size"
        ],
        "size": [
          "create"
        ]
      },
      "properties": {
        "mnt": {
          "type": "string",
          "description": "Mount point",
          "pattern": "^/.*$",
          "maxLength": 255
        },
        "key": {
          "type": [
            "string",
            "null"
          ],
          "description": "Disk encryption key (hex-encoded).",
          "pattern": "^[0-9A-Fa-f]$"
        },
        "key_id": {
          "type": [
            "string",
            "null"
          ],
          "description": "Name/identifier of disk encryption key."
        },
        "fresh_key": {
          "type": "boolean",
          "default": false
        },
        "roothash": {
          "type": [
            "string",
            "null"
          ],
          "description": "dm-verity hash."
        },
        "roothash_offset": {
          "$ref": "#/definitions/safe_number",
          "description": "dm-verity hash offset."
        },
        "readonly": {
          "type": "boolean",
          "description": "Whether to mount the disk read-only",
          "default": false
        },
        "create": {
          "type": "boolean",
          "description": "Whether to dynamically create the disk (note that an empty image file must exist).",
          "default": false
        },
        "size": {
          "$ref": "#/definitions/safe_number",
          "description": "Size of the ext4 filesystem in the dynamically created disk when \"create\": true."
        },
        "overlay": {
          "type": "boolean",
          "description": "Whether to create an in-memory writable overlay for a read-only root disk",
          "default": false
        }
      }
    },
    "sgxlkl_enclave_wg_peer_config_t": {
      "type": "object",
      "properties": {
        "key": {
          "type": "string"
        },
        "allowed_ips": {
          "type": "string"
        },
        "endpoint": {
          "type": "string"
        }
      }
    },
    "sgxlkl_enclave_wg_config_t": {
      "type": "object",
      "properties": {
        "ip": {
          "type": "string"
        },
        "listen_port": {
          "$ref": "#/definitions/safe_number"
        },
        "key": {
          "type": [
            "string",
            "null"
          ]
        },
        "peers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/sgxlkl_enclave_wg_peer_config_t"
          }
        }
      }
    },
    "sgxlkl_image_sizes_config_t": {
      "type": "object",
      "properties": {
        "num_heap_pages": {
          "$ref": "#/definitions/safe_number",
          "default": "262144"
        },
        "num_stack_pages": {
          "$ref": "#/definitions/safe_number",
          "default": "1024"
        },
        "num_tcs": {
          "$ref": "#/definitions/safe_number",
          "default": "8"
        }
      }
    },
    "sgxlkl_enclave_config_t": {
      "format_version": {
        "$ref": "#/definitions/safe_number",
        "description": "Version number of the enclave config type."
      },
      "mode": {
        "type": "string",
        "description": "Enclave execution mode.",
        "pattern": "^sw_debug|hw_debug|hw_release$"
      },
      "net_ip4": {
        "type": "string",
        "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$",
        "description": "IPv4 address."
      },
      "net_gw4": {
        "type": "string",
        "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$",
        "description": "IPv4 gateway address."
      },
      "net_mask4": {
        "type": "string",
        "description": "IPv4 netmask.",
        "pattern": "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31|32"
      },
      "hostname": {
        "type": "string",
        "maxLength": 31
      },
      "hostnet": {
        "type": "boolean"
      },
      "tap_mtu": {
        "$ref": "#/definitions/safe_number"
      },
      "wg": {
        "$ref": "#/definitions/sgxlkl_enclave_wg_config_t"
      },
      "ethreads": {
        "$ref": "#/definitions/safe_number"
      },
      "max_user_threads": {
        "$ref": "#/definitions/safe_number"
      },
      "espins": {
        "$ref": "#/definitions/safe_number"
      },
      "esleep": {
        "$ref": "#/definitions/safe_number"
      },
      "clock_res": {
        "type": "array",
        "minLength": 8,
        "maxLength": 8,
        "items": {
          "$ref": "#/definitions/sgxlkl_clock_res_config_t"
        }
      },
      "stacksize": {
        "$ref": "#/definitions/safe_number"
      },
      "mmap_files": {
        "$ref": "#/definitions/sgxlkl_enclave_mmap_files_t",
        "default": "none"
      },
      "oe_heap_pagecount": {
        "$ref": "#/definitions/safe_number"
      },
      "fsgsbase": {
        "type": "boolean"
      },
      "verbose": {
        "type": "boolean"
      },
      "kernel_verbose": {
        "type": "boolean"
      },
      "kernel_cmd": {
        "type": "string"
      },
      "sysctl": {
        "type": [
          "string",
          "null"
        ]
      },
      "swiotlb": {
        "type": "boolean"
      },
      "run": {
        "type": "string",
        "description": "Path to the application"
      },
      "cwd": {
        "type": "string",
        "description": "Path to the working directory",
        "default": "/"
      },
      "argv": {
        "type": "array",
        "description": "Application arguments",
        "default": [],
        "items": {
          "type": "string"
        }
      },
      "envp": {
        "type": "array",
        "description": "Environment variables",
        "default": [],
        "items": {
          "type": "string"
        }
      },
      "auxv": {
        "type": "array",
        "description": "ELF64 Aux vector",
        "default": [],
        "items": {
          "$ref": "#/definitions/Elf64_auxv_t"
        }
      },
      "host_import_envp": {
        "type": "array",
        "description": "List of environment variables to be imported from the host",
        "default": [],
        "items": {
          "type": "string"
        }
      },
      "exit_status": {
        "$ref": "#/definitions/sgxlkl_exit_status_mode_t",
        "description": "Whether and how the enclave exit code is reported to the host",
        "default": "full"
      },
      "disks": {
        "type": "array",
        "description": "Disks to mount",
        "items": {
          "$ref": "#/definitions/sgxlkl_enclave_disk_config_t"
        }
      },
      "image_sizes": {
        "$ref": "#/definitions/sgxlkl_image_sizes_config_t"
      }
    }
  },
  "$ref": "#/definitions/sgxlkl_enclave_config_t"
}