{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SGX-LKL enclave config schema",
  "required": [
    "mode",
    "run",
    "disks"
  ],
  "additionalProperties": false,
  "definitions": {
    "safe_uint8_t": {
      "type": "string",
      "pattern": "^0$|^[1-9][0-9]*$",
      "maxLength": 3
    },
    "safe_uint32_t": {
      "type": "string",
      "pattern": "^0$|^[1-9][0-9]*$",
      "maxLength": 10
    },
    "safe_uint64_t": {
      "type": "string",
      "pattern": "^0$|^[1-9][0-9]*$",
      "maxLength": 20
    },
    "safe_size_t": {
      "type": "string",
      "pattern": "^0$|^[1-9][0-9]*$",
      "maxLength": 20
    },
    "sgxlkl_enclave_mode_t": {
      "enum": [
        "UNKNOWN_MODE",
        "SW_DEBUG_MODE",
        "HW_DEBUG_MODE",
        "HW_RELEASE_MODE"
      ]
    },
    "sgxlkl_enclave_mmap_files_t": {
      "enum": [
        "ENCLAVE_MMAP_FILES_NONE",
        "ENCLAVE_MMAP_FILES_PRIVATE",
        "ENCLAVE_MMAP_FILES_SHARED"
      ]
    },
    "sgxlkl_exit_status_mode_t": {
      "enum": [
        "EXIT_STATUS_FULL",
        "EXIT_STATUS_BINARY",
        "EXIT_STATUS_NONE"
      ]
    },
    "Elf64_auxv_t": {
      "type": "object",
      "properties": {
        "a_type": {
          "type": "string"
        },
        "a_val": {
          "type": "string"
        }
      }
    },
    "sgxlkl_clock_res_config_t": {
      "type": "object",
      "properties": {
        "resolution": {
          "type": "string",
          "minLength": 16,
          "maxLength": 16,
          "pattern": "^[0-9A-Fa-f]+$",
          "default": "0000000000000000"
        }
      }
    },
    "sgxlkl_enclave_disk_config_t": {
      "type": "object",
      "description": "Disk configuration",
      "required": [
        "mnt"
      ],
      "additionalProperties": false,
      "dependencies": {
        "roothash": [
          "roothash_offset"
        ],
        "roothash_offset": [
          "roothash"
        ],
        "create": [
          "size"
        ],
        "size": [
          "create"
        ]
      },
      "properties": {
        "mnt": {
          "type": "string",
          "description": "Mount point",
          "pattern": "^/.*$",
          "maxLength": 255
        },
        "key": {
          "type": "array",
          "description": "Disk encryption key (hex-encoded).",
          "pattern": "^[0-9A-Fa-f]$",
          "items": {
            "$ref": "#/definitions/safe_uint8_t"
          },
          "default": null
        },
        "key_id": {
          "type": [
            "string",
            "null"
          ],
          "description": "Name/identifier of disk encryption key."
        },
        "fresh_key": {
          "type": "boolean",
          "default": false
        },
        "roothash": {
          "type": [
            "string",
            "null"
          ],
          "description": "dm-verity hash.",
          "default": null
        },
        "roothash_offset": {
          "$ref": "#/definitions/safe_size_t",
          "description": "dm-verity hash offset.",
          "default": "0"
        },
        "readonly": {
          "type": "boolean",
          "description": "Whether to mount the disk read-only",
          "default": false
        },
        "create": {
          "type": "boolean",
          "description": "Whether to dynamically create the disk (note that an empty image file must exist).",
          "default": false
        },
        "size": {
          "$ref": "#/definitions/safe_size_t",
          "description": "Size of the ext4 filesystem in the dynamically created disk when \"create\": true.",
          "default": "0"
        },
        "overlay": {
          "type": "boolean",
          "description": "Whether to create an in-memory writable overlay for a read-only root disk",
          "default": false
        }
      }
    },
    "sgxlkl_enclave_wg_peer_config_t": {
      "type": "object",
      "properties": {
        "key": {
          "type": "string"
        },
        "allowed_ips": {
          "type": "string"
        },
        "endpoint": {
          "type": "string"
        }
      }
    },
    "sgxlkl_enclave_wg_config_t": {
      "type": "object",
      "properties": {
        "ip": {
          "type": "string",
          "default": "10.0.2.1"
        },
        "listen_port": {
          "$ref": "#/definitions/safe_uint32_t",
          "default": "56002"
        },
        "key": {
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "peers": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/sgxlkl_enclave_wg_peer_config_t"
          },
          "default": "[]"
        }
      }
    },
    "sgxlkl_image_sizes_config_t": {
      "type": "object",
      "properties": {
        "num_heap_pages": {
          "$ref": "#/definitions/safe_uint64_t",
          "default": "262144"
        },
        "num_stack_pages": {
          "$ref": "#/definitions/safe_uint64_t",
          "default": "1024"
        },
        "num_tcs": {
          "$ref": "#/definitions/safe_uint64_t",
          "default": "8"
        }
      }
    },
    "sgxlkl_enclave_config_t": {
      "type": "object",
      "properties": {
        "format_version": {
          "$ref": "#/definitions/safe_size_t",
          "description": "Version number of the enclave config type."
        },
        "mode": {
          "$ref": "#/definitions/sgxlkl_enclave_mode_t",
          "description": "Enclave execution mode.",
          "default": "HW_RELEASE_MODE"
        },
        "net_ip4": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$",
          "description": "IPv4 address.",
          "default": "10.0.1.1"
        },
        "net_gw4": {
          "type": "string",
          "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+$",
          "description": "IPv4 gateway address.",
          "default": "10.0.1.254"
        },
        "net_mask4": {
          "type": "string",
          "description": "IPv4 netmask.",
          "pattern": "1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23|24|25|26|27|28|29|30|31|32",
          "default": "24"
        },
        "hostname": {
          "type": "string",
          "maxLength": 31,
          "default": "lkl"
        },
        "hostnet": {
          "type": "boolean",
          "default": false
        },
        "tap_mtu": {
          "$ref": "#/definitions/safe_uint32_t",
          "default": "0"
        },
        "wg": {
          "$ref": "#/definitions/sgxlkl_enclave_wg_config_t"
        },
        "ethreads": {
          "$ref": "#/definitions/safe_size_t",
          "default": "1"
        },
        "max_user_threads": {
          "$ref": "#/definitions/safe_size_t",
          "default": "256"
        },
        "espins": {
          "$ref": "#/definitions/safe_size_t",
          "default": "500"
        },
        "esleep": {
          "$ref": "#/definitions/safe_size_t",
          "default": "16000"
        },
        "clock_res": {
          "type": "array",
          "minLength": 8,
          "maxLength": 8,
          "items": {
            "$ref": "#/definitions/sgxlkl_clock_res_config_t"
          },
          "default": "{{\"0000000000000001\"},{\"0000000000000001\"},{\"0000000000000000\"},{\"0000000000000000\"},{\"0000000000000001\"},{\"00000000003d0900\"},{\"00000000003d0900\"},{\"0000000000000001\"}}"
        },
        "stacksize": {
          "$ref": "#/definitions/safe_size_t",
          "default": "524288"
        },
        "mmap_files": {
          "$ref": "#/definitions/sgxlkl_enclave_mmap_files_t",
          "default": "ENCLAVE_MMAP_FILES_NONE"
        },
        "oe_heap_pagecount": {
          "$ref": "#/definitions/safe_size_t",
          "default": "8192"
        },
        "fsgsbase": {
          "type": "boolean",
          "default": true
        },
        "verbose": {
          "type": "boolean",
          "default": false
        },
        "kernel_verbose": {
          "type": "boolean",
          "default": false
        },
        "kernel_cmd": {
          "type": "string",
          "default": "mem=32M"
        },
        "sysctl": {
          "type": [
            "string",
            "null"
          ],
          "default": null
        },
        "swiotlb": {
          "type": "boolean",
          "default": true
        },
        "run": {
          "type": "string",
          "description": "Path to the application",
          "default": null
        },
        "cwd": {
          "type": "string",
          "description": "Path to the working directory",
          "default": "/",
          "overridable": "SGXLKL_CWD"
        },
        "argv": {
          "type": "array",
          "description": "Application arguments",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "envp": {
          "type": "array",
          "description": "Environment variables",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "auxv": {
          "type": "array",
          "description": "ELF64 Aux vector",
          "default": [],
          "items": {
            "$ref": "#/definitions/Elf64_auxv_t"
          }
        },
        "host_import_envp": {
          "type": "array",
          "description": "List of environment variables to be imported from the host",
          "default": [],
          "items": {
            "type": "string"
          }
        },
        "exit_status": {
          "$ref": "#/definitions/sgxlkl_exit_status_mode_t",
          "description": "Whether and how the enclave exit code is reported to the host",
          "default": "EXIT_STATUS_FULL"
        },
        "disks": {
          "type": "array",
          "description": "Disks to mount",
          "items": {
            "$ref": "#/definitions/sgxlkl_enclave_disk_config_t"
          }
        },
        "image_sizes": {
          "$ref": "#/definitions/sgxlkl_image_sizes_config_t"
        }
      }
    }
  },
  "$ref": "#/definitions/sgxlkl_enclave_config_t"
}